<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿæ¯å‚³èªª</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { background-color: #222; color: #fff; font-family: sans-serif; padding: 5px; text-align: center; }
        .card { display: inline-block; width: 60px; height: 80px; margin: 3px; border-radius: 4px; background: #eee; color: #333; cursor: pointer; line-height: 80px; font-weight: bold; font-size: 12px; }
        .card.atk { background: #ffcccc; border-bottom: 3px solid #cc0000; }
        .card.magic { background: #ccccff; border-bottom: 3px solid #0000cc; }
        .team-box { display: flex; justify-content: space-between; padding: 5px; background: #333; margin-bottom: 5px; font-size: 0.8em; }
        .gem { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin: 1px; }
        .gem.red { background: #f44; box-shadow: 0 0 3px #f00; }
        .gem.blue { background: #44f; box-shadow: 0 0 3px #00f; }
        .action-btn { width: 30%; background: #555; border: 1px solid #777; color: white; padding: 5px; margin: 2px; }
    </style>
</head>
<body>
    <!-- é¸æ“‡è§’è‰²é  (ç•¥ï¼ŒåŒå‰) -->
    <div id="login-view" style="display:none;">...</div>

    <div id="game-view" style="display:none;">
        <!-- æˆ°å ´è³‡è¨Š -->
        <div class="team-box" style="border-left: 5px solid #f44;">
            <span>RED å£«æ°£: <span id="red-morale"></span></span>
            <span id="red-gems"></span>
            <span>ğŸ†: <span id="red-grails"></span></span>
        </div>
        <div class="team-box" style="border-left: 5px solid #44f;">
            <span>BLUE å£«æ°£: <span id="blue-morale"></span></span>
            <span id="blue-gems"></span>
            <span>ğŸ†: <span id="blue-grails"></span></span>
        </div>

        <div style="margin:5px 0;">
            <span id="p-name" style="font-weight:bold; color:#fe0;"></span> 
            <span id="turn-indicator" style="color:#aaa;"></span>
        </div>

        <!-- è­¦å‘Šå€ (è¢«æ”»æ“Š/é­”å½ˆ/è™›å¼±) -->
        <div id="alert-box" style="display:none; background:#500; padding:10px; margin-bottom:5px;">
            <div id="alert-msg"></div>
            <div id="alert-actions"></div>
        </div>

        <!-- æ‰‹ç‰Œå€ -->
        <div id="hand-area">
            <div id="hand-list"></div>
            <div style="margin-top:10px; border-top:1px solid #444; padding-top:5px;">
                <button class="action-btn" onclick="sendCmd('è³¼è²·')">è³¼è²·</button>
                <button class="action-btn" onclick="sendCmd('åˆæˆ')">åˆæˆ</button>
                <button class="action-btn" onclick="sendCmd('æç…‰')">æç…‰</button>
            </div>
        </div>

        <!-- ç›®æ¨™é¸æ“‡å€ (ç•¥ï¼ŒåŒå‰) -->
        <div id="target-area" style="display:none;">...</div>
    </div>

    <script>
        // ... (login/init é‚è¼¯åŒå‰) ...

        function renderGameUI() {
            // æ›´æ–°åœ˜éšŠæ•¸æ“š
            const t = myData.teams;
            document.getElementById('red-morale').innerText = t.RED.morale;
            document.getElementById('blue-morale').innerText = t.BLUE.morale;
            document.getElementById('red-grails').innerText = t.RED.grails;
            document.getElementById('blue-grails').innerText = t.BLUE.grails;
            
            renderGems('red-gems', t.RED.gems);
            renderGems('blue-gems', t.BLUE.gems);

            // ç‹€æ…‹åˆ¤å®š
            const incoming = myData.incoming_attack;
            const alertBox = document.getElementById('alert-box');
            const alertMsg = document.getElementById('alert-msg');
            const alertActs = document.getElementById('alert-actions');
            alertBox.style.display = 'none';
            alertActs.innerHTML = '';

            // é­”å½ˆ/æ”»æ“Š è­¦å‘Š
            if (incoming && incoming.target_id === myData.my_id) {
                alertBox.style.display = 'block';
                alertMsg.innerText = `âš ï¸ é­é‡ ${incoming.type === 'missile' ? 'é­”å½ˆ' : 'æ”»æ“Š'}ï¼`;
                
                let btn = document.createElement('button');
                btn.innerText = "ç›´æ¥æ‰¿å—";
                btn.style.width = "100%";
                btn.onclick = () => sendCmd("æ‰¿å—");
                alertActs.appendChild(btn);
            }

            // è™›å¼±é¸æ“‡ (åˆ©ç”¨ phase åˆ¤æ–·ï¼Œé€™è£¡å‡è¨­ phase æœƒå‚³å›ä¾†)
            // ä½ éœ€è¦åœ¨ API my_status å›å‚³ game_phase
            // if (myData.game_phase === 'CHOOSING_WEAKNESS' && myData.is_my_turn) ...
        }

        function renderGems(elId, gems) {
            const div = document.getElementById(elId);
            div.innerHTML = '';
            gems.forEach(color => {
                let s = document.createElement('span');
                s.className = `gem ${color}`;
                div.appendChild(s);
            });
        }

        function sendCmd(cmd) {
            // æª¢æŸ¥æ˜¯å¦è¼ªåˆ°è‡ªå·±
            if (!myData.is_my_turn) { alert("ä¸æ˜¯ä½ çš„å›åˆ"); return; }
            let prefix = `[${myData.name}] `;
            liff.sendMessages([{ type: 'text', text: prefix + cmd }])
                .then(() => liff.closeWindow());
        }
        
        // ... (onCardClick é‚è¼¯éœ€å¢åŠ  é­”å½ˆ/ä¸­æ¯’/è™›å¼± çš„ç›®æ¨™é¸æ“‡) ...
    </script>
</body>
</html>