<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿæ¯å‚³èªª - å®Œæ•´ç‰ˆ</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* --- 1. å…¨åŸŸæ¨£å¼ --- */
        body { 
            background-color: #121212; 
            color: #e0e0e0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0; 
            padding: 0;
            text-align: center;
            padding-bottom: 20px;
        }

        /* --- 2. ç™»å…¥é¸è§’ä»‹é¢ --- */
        #login-view { padding: 20px; }
        .role-btn {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; padding: 15px; margin-bottom: 12px;
            background: #2c2c2c; border: 1px solid #444; color: white;
            font-size: 16px; border-radius: 8px; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .role-btn:active { background: #444; transform: scale(0.98); }
        .role-btn.RED { border-left: 8px solid #d32f2f; }
        .role-btn.BLUE { border-left: 8px solid #1976d2; }

        /* --- 3. æˆ°ç¸¾æ¿ (Scoreboard) --- */
        .scoreboard { 
            display: flex; justify-content: space-between; 
            background: #1e1e1e; padding: 8px 12px;
            border-bottom: 1px solid #333;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .team-box { 
            width: 48%; padding: 6px; 
            border-radius: 6px; background: rgba(255,255,255,0.05);
            font-size: 13px; line-height: 1.5;
        }
        .team-box.RED { border: 1px solid #b71c1c; }
        .team-box.BLUE { border: 1px solid #0d47a1; }

        /* å¯¶çŸ³ç‰¹æ•ˆ */
        .gems-row { height: 16px; margin-top: 4px; display: flex; justify-content: center; }
        .gem { 
            width: 10px; height: 10px; border-radius: 50%; margin: 0 2px; 
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 0 5px currentColor;
        }
        .gem.red { background-color: #ff1744; color: #ff1744; }
        .gem.blue { background-color: #2979ff; color: #2979ff; }

        /* --- 4. ç©å®¶ç‹€æ…‹åˆ— --- */
        .status-bar {
            padding: 10px 15px; background: #252525;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #3e3e3e;
        }
        .player-info { text-align: left; }
        .player-name { font-size: 18px; font-weight: bold; color: #ffca28; }
        .turn-indicator { font-size: 12px; color: #9e9e9e; margin-top: 2px; }
        
        /* --- 5. æç¤ºèˆ‡è­¦å‘Šå€ --- */
        #alert-box { 
            display: none; margin: 15px; padding: 15px; 
            border-radius: 8px; font-weight: bold; font-size: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.85; } 100% { opacity: 1; } }
        .alert-attack { background: #b71c1c; border: 1px solid #ff8a80; color: #ffebee; }
        .alert-weak { background: #4a148c; border: 1px solid #ea80fc; color: #f3e5f5; }

        /* --- 6. æ‘¸ç‰Œèˆ‡æ£„ç‰ŒæŒ‰éˆ• --- */
        .phase-btn {
            display: block; width: 90%; margin: 10px auto; padding: 15px;
            font-size: 18px; font-weight: bold; color: white; border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            transition: transform 0.1s;
        }
        .phase-btn:active { transform: scale(0.95); }
        .btn-draw { 
            background: linear-gradient(135deg, #ff9800, #f57c00); 
            animation: bounce 1s infinite alternate;
        }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-3px); } }
        
        .discard-hint {
            background: #d32f2f; color: white; padding: 10px; margin: 10px; border-radius: 5px;
        }

        /* --- 7. æ‰‹ç‰Œå€åŸŸ --- */
        #hand-area { padding: 10px 5px; min-height: 120px; }
        .card { 
            display: inline-block; width: 72px; height: 100px; margin: 5px; 
            border-radius: 8px; background: #eee; color: #222; 
            cursor: pointer; position: relative; vertical-align: top;
            box-shadow: 2px 3px 6px rgba(0,0,0,0.4);
            font-size: 13px; font-weight: bold; line-height: 100px;
            border-bottom-width: 6px; border-bottom-style: solid;
        }
        /* æ ¹æ“šå±¬æ€§é…è‰² */
        .card.atk { background: #ffebee; border-color: #c62828; color: #b71c1c; } /* æ”»æ“Š */
        .card.def { background: #e8f5e9; border-color: #2e7d32; color: #1b5e20; } /* é–ƒé¿/è–å…‰ */
        .card.magic { background: #e3f2fd; border-color: #1565c0; color: #0d47a1; } /* æ³•è¡“ */
        .card.dark { background: #cfd8dc; border-color: #37474f; color: #263238; } /* æš—å±¬æ€§ */

        /* --- 8. åº•éƒ¨è¡Œå‹•åˆ— --- */
        #action-bar { 
            display: flex; justify-content: space-around; 
            padding: 15px 10px; border-top: 1px solid #333; margin-top: 10px;
            background: #1a1a1a;
        }
        .act-btn {
            width: 30%; padding: 12px; border: 1px solid #555; border-radius: 6px;
            background: #333; color: #eee; font-weight: bold; cursor: pointer;
        }
        .act-btn:active { background: #555; }

        /* --- 9. ç›®æ¨™é¸æ“‡è¦–çª— (Modal) --- */
        #target-area { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 1000; padding-top: 60px;
        }
        .target-list { max-height: 60vh; overflow-y: auto; padding: 0 20px; }
        .target-btn {
            display: block; width: 100%; padding: 16px; margin: 10px 0;
            background: #2c2c2c; border: 1px solid #555; color: white;
            font-size: 18px; border-radius: 8px; cursor: pointer;
        }
        .cancel-btn { 
            margin-top: 30px; padding: 12px 50px; background: #616161; 
            border: none; color: white; font-size: 16px; border-radius: 30px;
        }
    </style>
</head>
<body>
    <div id="loading" style="padding:50px;">æ­£åœ¨é€£ç·šè‡³æ˜Ÿæ¯ç³»çµ±...</div>

    <!-- ===== ç™»å…¥é¸è§’é é¢ ===== -->
    <div id="login-view" style="display:none;">
        <h3 style="color:#ffca28; margin-bottom:20px;">é¸æ“‡æ‰®æ¼”è§’è‰²</h3>
        <div id="player-list"></div>
        <p style="color:#666; font-size:12px; margin-top:30px;">
            (é–‹ç™¼æ¸¬è©¦æ¨¡å¼ï¼šè‹¥ç„¡è§’è‰²è«‹åœ¨ç¾¤çµ„è¼¸å…¥ <b>@æ¸¬è©¦é–‹å±€</b>)
        </p>
    </div>

    <!-- ===== éŠæˆ²ä¸»ç•«é¢ ===== -->
    <div id="game-view" style="display:none;">
        
        <!-- é ‚éƒ¨æˆ°ç¸¾æ¿ -->
        <div class="scoreboard">
            <div class="team-box RED">
                <div style="font-weight:bold; color:#ef5350;">RED éšŠ (å£«æ°£ <span id="r-mor"></span>)</div>
                <div class="gems-row" id="r-gems"></div>
                <div style="margin-top:2px;">ğŸ† æ˜Ÿæ¯: <span id="r-grails"></span></div>
            </div>
            <div class="team-box BLUE">
                <div style="font-weight:bold; color:#42a5f5;">BLUE éšŠ (å£«æ°£ <span id="b-mor"></span>)</div>
                <div class="gems-row" id="b-gems"></div>
                <div style="margin-top:2px;">ğŸ† æ˜Ÿæ¯: <span id="b-grails"></span></div>
            </div>
        </div>

        <!-- ç‹€æ…‹åˆ— -->
        <div class="status-bar">
            <div class="player-info">
                <div class="player-name" id="p-name"></div>
                <div class="turn-indicator" id="turn-msg">è¼‰å…¥ä¸­...</div>
            </div>
            <button onclick="logout()" style="background:#424242; color:#fff; border:none; padding:8px 12px; border-radius:4px;">åˆ‡æ›</button>
        </div>

        <!-- æ‘¸ç‰ŒæŒ‰éˆ•å€ (DRAWING Phase) -->
        <div id="draw-area" style="display:none;">
            <button class="phase-btn btn-draw" onclick="sendCmd('@æ‘¸ç‰Œ')">
                ğŸ´ é»æ“Šæ‘¸ç‰Œ <br>
                <span style="font-size:14px; opacity:0.9;">(é‚„éœ€ <span id="draw-count"></span> å¼µ)</span>
            </button>
        </div>

        <!-- æ£„ç‰Œæç¤ºå€ (DISCARDING Phase) -->
        <div id="discard-area" style="display:none;">
            <div class="discard-hint">
                âš ï¸ æ‰‹ç‰Œéå¤šï¼<br>
                è«‹é»æ“Šæ‰‹ç‰Œæ£„æ‰ <span id="discard-count" style="font-weight:bold; font-size:1.4em;"></span> å¼µ
            </div>
        </div>

        <!-- è­¦å‘Šè¨Šæ¯å€ (è¢«æ”»æ“Š/è™›å¼±) -->
        <div id="alert-box">
            <div id="alert-msg"></div>
            <div id="alert-actions" style="margin-top:10px;"></div>
        </div>

        <!-- æ‰‹ç‰Œåˆ—è¡¨ -->
        <div id="hand-area">
            <div id="hand-list"></div>
        </div>

        <!-- åº•éƒ¨è¡Œå‹•åˆ— (åƒ…åœ¨ ACTION éšæ®µé¡¯ç¤º) -->
        <div id="action-bar">
            <button class="act-btn" onclick="sendCmd('è³¼è²·')">ğŸ’° è³¼è²·</button>
            <button class="act-btn" onclick="sendCmd('åˆæˆ')">âš—ï¸ åˆæˆ</button>
            <button class="act-btn" onclick="sendCmd('æç…‰')">âš¡ æç…‰</button>
        </div>
    </div>

    <!-- ===== ç›®æ¨™é¸æ“‡å½ˆçª— ===== -->
    <div id="target-area">
        <h3 id="target-title" style="color:#fff; font-size:22px;">é¸æ“‡ç›®æ¨™</h3>
        <div class="target-list" id="target-list"></div>
        <button class="cancel-btn" onclick="closeTarget()">å–æ¶ˆ</button>
    </div>

    <script>
        const LIFF_ID = "{{ liff_id }}";
        let currentSimulateId = null;
        let myData = null;
        let selectedCard = "";
        let actionType = ""; // ATTACK, SUPPORT, COUNTER, ANY

        // --- åˆå§‹åŒ– ---
        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) { liff.login(); return; }
                loadPlayerList();
            } catch (err) {
                document.getElementById('loading').innerText = "LIFF Error: " + err;
            }
        }

        // --- ç™»å…¥èˆ‡ç©å®¶åˆ—è¡¨ ---
        function loadPlayerList() {
            fetch('/api/get_all_players')
                .then(r => r.json())
                .then(list => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('login-view').style.display = 'block';
                    document.getElementById('game-view').style.display = 'none';
                    
                    const container = document.getElementById('player-list');
                    container.innerHTML = '';
                    if (list.length === 0) {
                        container.innerHTML = "<p style='color:#888'>æš«ç„¡ç©å®¶è³‡æ–™</p>"; return;
                    }

                    list.forEach(p => {
                        let btn = document.createElement('div');
                        btn.className = `role-btn ${p.team}`;
                        
                        // ç‹€æ…‹åœ–ç¤º
                        let buffs = "";
                        if(p.buffs.poison) buffs += "â˜ ï¸";
                        if(p.buffs.weak) buffs += "ğŸ’¤";
                        if(p.buffs.shield) buffs += "ğŸ›¡ï¸";

                        btn.innerHTML = `
                            <span>${p.name} <small>(${p.team})</small> ${buffs}</span>
                            <span style="font-weight:bold;">ğŸƒ ${p.hand_count}</span>
                        `;
                        btn.onclick = () => loginAs(p.id);
                        container.appendChild(btn);
                    });
                });
        }

        function loginAs(id) {
            currentSimulateId = id;
            document.getElementById('login-view').style.display = 'none';
            fetchStatus();
        }

        function logout() {
            currentSimulateId = null;
            loadPlayerList();
        }

        // --- æ ¸å¿ƒç‹€æ…‹åŒæ­¥ ---
        function fetchStatus() {
            fetch('/api/my_status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ simulate_id: currentSimulateId })
            })
            .then(r => r.json())
            .then(data => {
                if (data.error) { alert(data.error); logout(); return; }
                myData = data;
                renderUI();
            })
            .catch(err => alert("é€£ç·šéŒ¯èª¤: " + err));
        }

        // --- ä»‹é¢æ¸²æŸ“ (Render) ---
        function renderUI() {
            document.getElementById('game-view').style.display = 'block';
            
            // 1. æˆ°ç¸¾æ›´æ–°
            const t = myData.teams;
            document.getElementById('r-mor').innerText = t.RED.morale;
            document.getElementById('b-mor').innerText = t.BLUE.morale;
            document.getElementById('r-grails').innerText = t.RED.grails;
            document.getElementById('b-grails').innerText = t.BLUE.grails;
            renderGems('r-gems', t.RED.gems);
            renderGems('b-gems', t.BLUE.gems);

            // 2. å€‹äººè³‡è¨Š
            const p = myData; // ç›®å‰è¦–è§’ç©å®¶
            document.getElementById('p-name').innerText = `${p.name} (${p.team})`;

            // 3. éšæ®µæ–‡å­—èˆ‡ä»‹é¢åˆ‡æ›
            const phase = p.game_phase;
            const isMyTurn = p.is_my_turn;
            let turnText = "ç­‰å¾…å…¶ä»–ç©å®¶...";

            // é è¨­éš±è—æ‰€æœ‰ç‰¹æ®Šå€å¡Š
            document.getElementById('draw-area').style.display = 'none';
            document.getElementById('discard-area').style.display = 'none';
            document.getElementById('alert-box').style.display = 'none';
            document.getElementById('action-bar').style.display = 'none';

            if (isMyTurn) {
                turnText = "â˜… è¼ªåˆ°ä½ çš„å›åˆ";
                
                if (phase === 'ACTION') {
                    document.getElementById('action-bar').style.display = 'flex';
                }
                else if (phase === 'DRAWING') {
                    turnText = "â˜… æ‘¸ç‰Œéšæ®µ";
                    document.getElementById('draw-area').style.display = 'block';
                    document.getElementById('draw-count').innerText = p.pending_count;
                }
                else if (phase === 'DISCARDING') {
                    turnText = "â˜… æ£„ç‰Œéšæ®µ";
                    document.getElementById('discard-area').style.display = 'block';
                    document.getElementById('discard-count').innerText = p.pending_count;
                }
                else if (phase === 'CHOOSING_WEAKNESS') {
                    turnText = "â˜… è™›å¼±ç‹€æ…‹é¸æ“‡";
                    const alertBox = document.getElementById('alert-box');
                    alertBox.className = 'alert-weak';
                    alertBox.style.display = 'block';
                    document.getElementById('alert-msg').innerText = "ğŸ’¤ è™›å¼±ç‹€æ…‹ï¼šè«‹é¸æ“‡è¡Œå‹•";
                    document.getElementById('alert-actions').innerHTML = `
                        <button class="act-btn" style="width:100%; margin-bottom:5px; background:#6a1b9a;" onclick="sendCmd('@æ‘¸ç‰Œ')">æ‘¸ 3 å¼µ (è§£é™¤è™›å¼±)</button>
                        <button class="act-btn" style="width:100%; background:#8e24aa;" onclick="sendCmd('@è·³é')">è·³éå›åˆ</button>
                    `;
                }
            } else {
                if (phase === 'RESOLVING') turnText = "âš¡ çµç®—ä¸­...";
            }
            
            // è¢«æ”»æ“Šåˆ¤å®š (RESOLVING éšæ®µ)
            const inc = p.incoming_attack;
            if (inc && inc.target_id === p.my_id) {
                const alertBox = document.getElementById('alert-box');
                alertBox.className = 'alert-attack';
                alertBox.style.display = 'block';
                
                let msg = "";
                if (inc.type === 'missile') msg = `âš ï¸ é­é‡é­”å½ˆ (å‚·å®³ ${inc.damage})ï¼`;
                else msg = `âš ï¸ ä¾†è‡ª ${inc.source_name} çš„ [${inc.card_name}] (${inc.element})ï¼`;
                
                document.getElementById('alert-msg').innerText = msg;
                document.getElementById('alert-actions').innerHTML = `
                    <button class="act-btn" style="width:100%; background:#c62828;" onclick="sendCmd('æ‰¿å—')">ç›´æ¥æ‰¿å—å‚·å®³</button>
                `;
            }

            document.getElementById('turn-msg').innerText = turnText;

            // 4. æ‰‹ç‰Œæ¸²æŸ“
            const list = document.getElementById('hand-list');
            list.innerHTML = '';
            p.hand.forEach(cardName => {
                let div = document.createElement('div');
                let type = getCardType(cardName);
                div.className = `card ${type}`;
                div.innerText = cardName;
                div.onclick = () => onCardClick(cardName, phase, isMyTurn);
                list.appendChild(div);
            });
        }

        // --- è¼”åŠ©å‡½å¼ ---
        function renderGems(id, gems) {
            const el = document.getElementById(id);
            el.innerHTML = '';
            gems.forEach(color => {
                let s = document.createElement('span');
                s.className = `gem ${color}`;
                el.appendChild(s);
            });
        }

        function getCardType(name) {
            if (name.includes('æš—é»‘')) return 'dark';
            if (name.includes('æ”»æ“Š')) return 'atk';
            if (name.includes('è–å…‰') || name.includes('é–ƒé¿')) return 'def';
            return 'magic'; // è–ç›¾, é­”å½ˆ, ä¸­æ¯’...
        }

        // --- å¡ç‰Œäº’å‹•é‚è¼¯ ---
        function onCardClick(card, phase, isMyTurn) {
            if (!isMyTurn) return; // ä¸æ˜¯ä½ çš„å›åˆ/éšæ®µ

            // 1. æ£„ç‰Œéšæ®µï¼šé»æ“Š = æ£„ç‰Œ
            if (phase === 'DISCARDING') {
                if (confirm(`ç¢ºèªæ£„æ‰ [${card}]ï¼Ÿ`)) sendCmd(`æ£„ç‰Œ [${card}]`);
                return;
            }

            // 2. æ‘¸ç‰Œéšæ®µï¼šç¦æ­¢æ“ä½œæ‰‹ç‰Œ
            if (phase === 'DRAWING') {
                alert("è«‹é»æ“Šä¸Šæ–¹çš„ã€Œé»æ“Šæ‘¸ç‰Œã€æŒ‰éˆ•ï¼");
                return;
            }

            // 3. è¢«æ”»æ“Š (æ‡‰æˆ°/è½‰ç§»)
            const inc = myData.incoming_attack;
            if (inc && inc.target_id === myData.my_id) {
                // é­”å½ˆè™•ç†
                if (inc.type === 'missile') {
                    if (['é­”å½ˆ','è–å…‰','è–ç›¾'].includes(card)) {
                        if(confirm(`ä½¿ç”¨ [${card}] æ‡‰å°é­”å½ˆï¼Ÿ`)) sendCmd(`æ‰“å‡ºäº† [${card}]`);
                    } else {
                        alert("é­”å½ˆåªèƒ½ç”¨ é­”å½ˆ/è–å…‰/è–ç›¾ æ‡‰å°ï¼");
                    }
                    return;
                }
                
                // æ™®é€šæ”»æ“Šè™•ç†
                if (card === 'è–å…‰') {
                    if (confirm("ä½¿ç”¨è–å…‰æŠµéŠ·æ”»æ“Šï¼Ÿ")) sendCmd(`æ‡‰æˆ° [${card}]`);
                } else {
                    if (confirm(`ç”¨ [${card}] æ‡‰æˆ°ä¸¦è½‰ç§»ï¼Ÿ`)) showTargets('COUNTER', card);
                }
                return;
            }

            // 4. ä¸»å‹•å‡ºç‰Œ (ACTION)
            if (phase === 'ACTION') {
                if (card.includes('æ”»æ“Š') || card.includes('æš—é»‘')) {
                    showTargets('ATTACK', card);
                } else if (card === 'é­”å½ˆ') {
                    if(confirm("ç™¼å°„é­”å½ˆï¼Ÿ(è‡ªå‹•é–å®šä¸‹å®¶)")) sendCmd(`æ‰“å‡ºäº† [${card}]`);
                } else if (['è–ç›¾','ä¸­æ¯’','è™›å¼±'].includes(card)) {
                    showTargets('ANY', card);
                } else {
                    alert("æ­¤ç‰Œç„¡æ³•ä¸»å‹•ä½¿ç”¨ (é€šå¸¸ç”¨æ–¼æ‡‰æˆ°)");
                }
            }
        }

        // --- ç›®æ¨™é¸æ“‡é‚è¼¯ ---
        function showTargets(mode, card) {
            selectedCard = card;
            actionType = mode;
            document.getElementById('target-area').style.display = 'block';
            
            let title = "";
            let filter = p => true;

            if (mode === 'ATTACK') {
                title = `ç”¨ [${card}] æ”»æ“Š...`;
                filter = p => p.team !== myData.team;
            } else if (mode === 'ANY') {
                title = `å°èª°ä½¿ç”¨ [${card}]ï¼Ÿ`;
            } else if (mode === 'COUNTER') {
                title = `æ‡‰æˆ°è½‰ç§»çµ¦...`;
                let src = myData.incoming_attack ? myData.incoming_attack.source_name : "";
                // æ’é™¤éšŠå‹ & æ”»æ“Šä¾†æº
                filter = p => p.team !== myData.team && p.name !== src;
            }

            document.getElementById('target-title').innerText = title;
            const list = document.getElementById('target-list');
            list.innerHTML = '';

            let targets = myData.all_players.filter(filter);
            
            if (targets.length === 0) {
                list.innerHTML = "<p style='color:#aaa'>ç„¡åˆæ³•ç›®æ¨™</p>";
            } else {
                targets.forEach(p => {
                    let b = document.createElement('button');
                    b.className = 'target-btn';
                    b.innerText = `${p.name} (${p.team})`;
                    // ç´…è—é‚Šæ¡†å€åˆ†
                    b.style.borderLeft = `5px solid ${p.team==='RED'?'#d32f2f':'#1976d2'}`;
                    
                    b.onclick = () => {
                        let cmd = "";
                        if (mode === 'ATTACK') cmd = `æ‰“å‡ºäº† [${selectedCard}] æ”»æ“Š ${p.name}`;
                        else if (mode === 'ANY') cmd = `æ‰“å‡ºäº† [${selectedCard}] å° ${p.name}`;
                        else if (mode === 'COUNTER') cmd = `æ‡‰æˆ° [${selectedCard}] å° ${p.name}`;
                        sendCmd(cmd);
                    };
                    list.appendChild(b);
                });
            }
        }

        function closeTarget() {
            document.getElementById('target-area').style.display = 'none';
        }

        function sendCmd(text) {
            // åœ¨é–‹ç™¼æ¨¡å¼ä¸‹ï¼Œæˆ‘å€‘åŠ ä¸Š [è§’è‰²å] å‰ç¶´ï¼Œæ–¹ä¾¿å¾Œç«¯è¾¨è­˜
            // æ­£å¼ç‰ˆå¯ä»¥æ”¹å›ç›´æ¥å‚³æŒ‡ä»¤
            const prefix = `[${myData.name}] `;
            liff.sendMessages([{ type: 'text', text: prefix + text }])
                .then(() => {
                    closeTarget();
                    liff.closeWindow();
                })
                .catch(err => {
                    alert("æŒ‡ä»¤ç™¼é€å¤±æ•—: " + err);
                });
        }

        main();
    </script>
</body>
</html>